<template>
  <div class="px-6 pt-6 2xl:container space-y-4">
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      <div class="md:col-span-2 lg:col-span-1">
        <div
          class="
            h-full
            py-8
            px-6
            space-y-6
            rounded-xl
            border border-gray-200
            bg-white
          "
        >
          <svg
            class="w-40 m-auto opacity-75"
            viewBox="0 0 146 146"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M73.1866 5.7129C81.999 5.7129 90.725 7.44863 98.8666 10.821C107.008 14.1933 114.406 19.1363 120.637 25.3675C126.868 31.5988 131.811 38.9964 135.184 47.138C138.556 55.2796 140.292 64.0057 140.292 72.818C140.292 81.6304 138.556 90.3565 135.184 98.4981C131.811 106.64 126.868 114.037 120.637 120.269C114.406 126.5 107.008 131.443 98.8666 134.815C90.725 138.187 81.999 139.923 73.1866 139.923C64.3742 139.923 55.6481 138.187 47.5066 134.815C39.365 131.443 31.9674 126.5 25.7361 120.269C19.5048 114.037 14.5619 106.64 11.1895 98.4981C7.81717 90.3565 6.08144 81.6304 6.08144 72.818C6.08144 64.0057 7.81717 55.2796 11.1895 47.138C14.5619 38.9964 19.5048 31.5988 25.7361 25.3675C31.9674 19.1363 39.365 14.1933 47.5066 10.821C55.6481 7.44863 64.3742 5.7129 73.1866 5.7129L73.1866 5.7129Z"
              stroke="#e4e4f2"
              stroke-width="4.89873"
            />
            <path
              d="M73.5 23.4494C79.9414 23.4494 86.3198 24.7181 92.2709 27.1831C98.222 29.6482 103.629 33.2612 108.184 37.816C112.739 42.3707 116.352 47.778 118.817 53.7291C121.282 59.6802 122.551 66.0586 122.551 72.5C122.551 78.9414 121.282 85.3198 118.817 91.2709C116.352 97.222 112.739 102.629 108.184 107.184C103.629 111.739 98.222 115.352 92.2709 117.817C86.3198 120.282 79.9414 121.551 73.5 121.551C67.0586 121.551 60.6802 120.282 54.7291 117.817C48.778 115.352 43.3707 111.739 38.816 107.184C34.2612 102.629 30.6481 97.222 28.1831 91.2709C25.7181 85.3198 24.4494 78.9414 24.4494 72.5C24.4494 66.0586 25.7181 59.6802 28.1831 53.7291C30.6481 47.778 34.2612 42.3707 38.816 37.816C43.3707 33.2612 48.778 29.6481 54.7291 27.1831C60.6802 24.7181 67.0586 23.4494 73.5 23.4494L73.5 23.4494Z"
              stroke="#e4e4f2"
              stroke-width="4.89873"
            />
            <path
              d="M73 24C84.3364 24 95.3221 27.9307 104.085 35.1225C112.848 42.3142 118.847 52.322 121.058 63.4406C123.27 74.5592 121.558 86.1006 116.214 96.0984C110.87 106.096 102.225 113.932 91.7515 118.27C81.278 122.608 69.6243 123.181 58.7761 119.89C47.9278 116.599 38.5562 109.649 32.258 100.223C25.9598 90.7971 23.1248 79.479 24.2359 68.1972C25.3471 56.9153 30.3357 46.3678 38.3518 38.3518"
              stroke="url(#paint0_linear_622:13617)"
              stroke-width="10"
              stroke-linecap="round"
            />
            <path
              d="M73 5.00001C84.365 5.00001 95.5488 7.84852 105.529 13.2852C115.509 18.7218 123.968 26.5732 130.131 36.1217C136.295 45.6702 139.967 56.6112 140.812 67.9448C141.657 79.2783 139.648 90.6429 134.968 101C130.288 111.357 123.087 120.375 114.023 127.232C104.96 134.088 94.3218 138.563 83.0824 140.248C71.8431 141.933 60.3606 140.775 49.6845 136.878C39.0085 132.981 29.4793 126.471 21.9681 117.942"
              stroke="url(#paint1_linear_622:13617)"
              stroke-width="10"
              stroke-linecap="round"
            />
            <path
              d="M9.60279 97.5926C6.37325 89.2671 4.81515 80.3871 5.01745 71.4595C5.21975 62.5319 7.1785 53.7316 10.7818 45.561C14.3852 37.3904 19.5626 30.0095 26.0184 23.8398C32.4742 17.6701 40.082 12.8323 48.4075 9.6028"
              stroke="url(#paint2_linear_622:13617)"
              stroke-width="10"
              stroke-linecap="round"
            />
            <path
              d="M73 5.00001C86.6504 5.00001 99.9849 9.10831 111.269 16.7904"
              stroke="url(#paint3_linear_622:13617)"
              stroke-width="10"
              stroke-linecap="round"
            />
            <circle
              cx="73.5"
              cy="72.5"
              r="29"
              fill="#e4e4f2"
              stroke="#e4e4f2"
            />
            <path
              d="M74 82.8332C68.0167 82.8332 63.1666 77.9831 63.1666 71.9998C63.1666 66.0166 68.0167 61.1665 74 61.1665C79.9832 61.1665 84.8333 66.0166 84.8333 71.9998C84.8333 77.9831 79.9832 82.8332 74 82.8332ZM74 80.6665C76.2985 80.6665 78.5029 79.7534 80.1282 78.1281C81.7535 76.5028 82.6666 74.2984 82.6666 71.9998C82.6666 69.7013 81.7535 67.4969 80.1282 65.8716C78.5029 64.2463 76.2985 63.3332 74 63.3332C71.7014 63.3332 69.497 64.2463 67.8717 65.8716C66.2464 67.4969 65.3333 69.7013 65.3333 71.9998C65.3333 74.2984 66.2464 76.5028 67.8717 78.1281C69.497 79.7534 71.7014 80.6665 74 80.6665ZM70.75 67.6665H77.25L79.9583 71.4582L74 77.4165L68.0416 71.4582L70.75 67.6665ZM71.8658 69.8332L70.8691 71.2307L74 74.3615L77.1308 71.2307L76.1341 69.8332H71.8658Z"
              fill="#6A6A9F"
            />
            <defs>
              <linearGradient
                id="paint0_linear_622:13617"
                x1="45.9997"
                y1="19"
                x2="46.0897"
                y2="124.308"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#E323FF" />
                <stop offset="1" stop-color="#7517F8" />
              </linearGradient>
              <linearGradient
                id="paint1_linear_622:13617"
                x1="1.74103e-06"
                y1="8.70228e-06"
                x2="6.34739e-08"
                y2="140.677"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#4DFFDF" />
                <stop offset="1" stop-color="#4DA1FF" />
              </linearGradient>
              <linearGradient
                id="paint2_linear_622:13617"
                x1="36.4997"
                y1="5.07257e-06"
                x2="36.6213"
                y2="142.36"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#FFD422" />
                <stop offset="1" stop-color="#FF7D05" />
              </linearGradient>
              <linearGradient
                id="paint3_linear_622:13617"
                x1="1.74103e-06"
                y1="8.70228e-06"
                x2="6.34739e-08"
                y2="140.677"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#4DFFDF" />
                <stop offset="1" stop-color="#4DA1FF" />
              </linearGradient>
            </defs>
          </svg>
          <div>
            <h5 class="text-xl text-gray-600 text-center">
              {{ parseDateAsYearMonth(monthlyCumulativeStatistics.date) }}
            </h5>
          </div>
          <table class="w-full text-gray-600">
            <tbody>
              <tr>
                <td class="py-2">Gross Revenue</td>
                <td class="text-gray-500">
                  Nu.
                  {{
                    thousandSeperator(
                      monthlyCumulativeStatistics.grossRevenue
                        ? monthlyCumulativeStatistics.grossRevenue
                        : 0
                    )
                  }}
                </td>
              
              </tr>
              <tr>
                <td class="py-2">Tickets Sold</td>
                <td class="text-gray-500">
                  {{
                    thousandSeperator(
                      monthlyCumulativeStatistics.ticketsSold
                        ? monthlyCumulativeStatistics.ticketsSold
                        : 0
                    )
                  }}
                </td>
              
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div>
        <div
          class="h-full py-6 px-6 rounded-xl border border-gray-200 bg-white"
        >
          <h5 class="text-xl text-gray-700 my-2">Online vs Counter</h5>

          <div class="overflow-scroll scrollbar-hide">
            <div>
              <line-chart
                prefix="Nu "
                width="800px"
                height="200px"
                :discrete="false"
                loading="Fetching Data..."
                :data="data2"
                legend="false"
                :colors="['#38D457', '#961BF9']"
              ></line-chart>
            </div>
          </div>
          <table class="mt-6 -mb-2 w-full text-gray-600">
            <tbody>
              <tr>
                <td class="py-2">Online</td>
                <td class="text-gray-500">
                  Nu.
                  {{
                    thousandSeperator(
                      monthlyCumulativeStatistics.onlineRevenue
                        ? monthlyCumulativeStatistics.onlineRevenue
                        : 0
                    )
                  }}
                </td>
                <td>
                 {{
                    thousandSeperator(
                      monthlyCumulativeStatistics.onlineTickets
                        ? monthlyCumulativeStatistics.onlineTickets 
                        : 0
                    )
                  }}
                </td>
              </tr>
              <tr>
                <td class="py-2">Counter</td>
                <td class="text-gray-500">
                  Nu.
                  {{
                    thousandSeperator(
                      monthlyCumulativeStatistics.counterRevenue
                        ? monthlyCumulativeStatistics.counterRevenue
                        : 0
                    )
                  }}
                </td>
                <td>
                 
                 {{
                    thousandSeperator(
                      monthlyCumulativeStatistics.counterTickets
                        ? monthlyCumulativeStatistics.counterTickets
                        : 0
                    )
                  }}
                 
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div>
        <div
          class="
            lg:h-full
            py-8
            px-6
            text-gray-600
            rounded-xl
            border border-gray-200
            bg-white
          "
        >
          <svg
            class="w-40 m-auto"
            viewBox="0 0 42 42"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle
              class="donut-hole"
              cx="21"
              cy="21"
              r="15.91549430918954"
              fill="#fff"
            ></circle>
            <circle
              class="donut-ring"
              cx="21"
              cy="21"
              r="15.91549430918954"
              fill="transparent"
              stroke="#d2d3d4"
              stroke-width="2"
            ></circle>

            <circle
              class="donut-segment"
              cx="21"
              cy="21"
              r="15.91549430918954"
              fill="transparent"
              stroke-linecap="round"
              stroke="url(#paint0_linear_622:13696)"
              stroke-width="3"
              :stroke-dasharray="computeDonutPercentage"
            ></circle>
            <g class="chart-text">
              <text x="50%" y="50%" class="chart-number">
                {{
                  Math.floor(
                    (monthlyCumulativeStatistics.onlineTickets /
                      monthlyCumulativeStatistics.ticketsSold) *
                      100
                  )
                }}
                %
              </text>
              <text x="50%" y="50%" class="chart-label">Online</text>
            </g>
            <defs>
              <linearGradient
                id="paint0_linear_622:13696"
                x1="5.54791e-07"
                y1="42.0001"
                x2="54.6039"
                y2="41.9535"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#E323FF" />
                <stop offset="1" stop-color="#7517F8" />
              </linearGradient>
            </defs>
          </svg>
          <div class="mt-6">
            <h5 class="text-xl text-gray-700 text-center">Market Share</h5>
            <div class="mt-2 flex flex-col items-center gap-4">
              <h3 class="text-3xl font-bold text-gray-700">
                {{
                  Math.floor(
                    (monthlyCumulativeStatistics.onlineTickets /
                      monthlyCumulativeStatistics.ticketsSold) *
                      100
                  )
                }}
                % <span class="text-sm"> of total Tickets Sold </span>
              </h3>
              <h3 class="text-3xl font-bold text-gray-700">
                {{
                  Math.floor(
                    (monthlyCumulativeStatistics.onlineRevenue /
                      monthlyCumulativeStatistics.grossRevenue) *
                      100
                  )
                }}
                % <span class="text-sm"> of Gross Revenue </span>
              </h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      <div class="md:col-span-3 lg:col-span-2">
        <div
          class="
            h-full
            py-8
            px-6
            space-y-6
            rounded-xl
            border border-gray-200
            bg-white
          "
        >
          <div>
            <h5 class="text-xl text-gray-600 text-left">Latest Bookings</h5>
          </div>
          <table class="w-full text-gray-600">
            <tbody>
              <tr
                v-for="booking in latestBookings"
                :key="booking"
                class="text-sm"
              >
                <td class="py-2">
                  id: {{ booking.id }}
                  <p>
                    {{ booking.route?.routepath?.origin?.name }} -
                    {{ booking.route?.routepath?.destination?.name }}
                  </p>
                  <p>
                    {{ booking.route?.departureTime }}
                  </p>
                  Mode:
                  {{ booking.modality === "ONLINE" ? "Online" : "Counter" }}
                </td>
                <td class="text-gray-500">
                  <p>Seats Booked: {{ booking.passengers?.length }}</p>
                  <p>Fare: Nu.{{ booking.fare }}</p>
                  <p>Total: Nu. {{ booking.amount }}</p>
                </td>
                <td class="py-2 my-2">
                  <p v-if="booking.modality === 'ONLINE'">Booked Online</p>
                  <p v-else>Booked by: {{ booking.user?.name }}</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div>
        <div
          class="
            lg:h-full
            py-8
            px-6
            text-gray-600
            rounded-xl
            border border-gray-200
            bg-white
          "
        >
          <div>
            <p class="font-semibold mb-2">Meto e-Accounts</p>

            <div class="flex flex-col items-start gap-4 w-full font-bold">
              <router-link to="/finance/challan" class="w-full">
                <button class="button-67">Daily Accounts Closing </button>
              </router-link>
              <!-- <button class="button-67" @click="underConstructionMsg">
                Bus Expenditures
              </button> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style>
@import url(https://fonts.googleapis.com/css?family=Montserrat:400);

body {
  font: 16px/1.4em "Montserrat", Arial, sans-serif;
}

* {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.neomorph-btn {
  border-radius: 0.6rem;
  padding: 0.8rem 1.6rem;
  background: rgb(241, 240, 240);
  box-shadow: 20px 20px 60px #d9d9d9, -20px -20px 60px #ffffff;
  color: #8da0ab;
  font-weight: bold;
  text-align: center;
  transition: background-color 0.5s ease;
  width: 100%;
}

.neomorph-btn:hover {
  background: #e4f2f9;
}

.chart-text {
  /*font: 16px/1.4em "Montserrat", Arial, sans-serif;*/
  fill: #000;
  -moz-transform: translateY(0.25em);
  -ms-transform: translateY(0.25em);
  -webkit-transform: translateY(0.25em);
  transform: translateY(0.25em);
}

.chart-number {
  font-size: 0.6em;
  line-height: 1;
  text-anchor: middle;
  -moz-transform: translateY(-0.25em);
  -ms-transform: translateY(-0.25em);
  -webkit-transform: translateY(-0.25em);
  transform: translateY(-0.25em);
}

.chart-label {
  font-size: 0.2em;
  text-transform: uppercase;
  text-anchor: middle;
  -moz-transform: translateY(0.7em);
  -ms-transform: translateY(0.7em);
  -webkit-transform: translateY(0.7em);
  transform: translateY(0.7em);
}

figure {
  display: flex;
  justify-content: space-around;
  flex-direction: column;
  margin-left: -15px;
  margin-right: -15px;
}

@media (min-width: 768px) {
  figure {
    flex-direction: row;
  }
}

.figure-content,
.figure-key {
  flex: 1;
  padding-left: 15px;
  padding-right: 15px;
  align-self: center;
}

.figure-content svg {
  height: auto;
}

.figure-key {
  min-width: calc(8 / 12);
}

.figure-key [class*="shape-"] {
  margin-right: 6px;
}

.figure-key-list {
  margin: 0;
  padding: 0;
  list-style: none;
}

.figure-key-list li {
  margin: 0 0 8px;
  padding: 0;
}

.shape-circle {
  display: inline-block;
  vertical-align: middle;
  width: 32px;
  height: 32px;
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
  border-radius: 50%;
}

.shape-fuschia {
  background-color: #ce4b99;
}

.shape-lemon-lime {
  background-color: #b1c94e;
}

.shape-blue {
  background-color: #377bbc;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  padding: 0;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}
</style>

<style scoped>
/* CSS */
.button-67 {
  align-items: center;
  background: #fefefe;
  border: 0;
  border-radius: 8px;
  width: 100%;
  box-shadow: -10px -10px 30px 0 #fff, 10px 10px 30px 0 #1d0dca17;
  box-sizing: border-box;
  color: #2a1f62;
  cursor: pointer;
  display: flex;
  font-size: 1rem;
  justify-content: center;
  line-height: 1.5rem;
  padding: 15px;
  position: relative;
  text-align: left;
  transition: 0.2s;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  white-space: pre;
  width: 100%;
  word-break: normal;
  word-spacing: normal;
}

.button-67:hover {
  background: #f8f8ff;
  box-shadow: -15px -15px 30px 0 #fff, 15px 15px 30px 0 #1d0dca17;
}

@media (min-width: 768px) {
  .button-67 {
    padding: 24px;
  }
}

.chart-container {
  margin: 40px;
  height: 400px;
  background-color: #f7f5f2;
}
</style>
<script>
import {
  getStaffStatsToday,
  getRouteStatsToday,
  getStatsByModalityToday,
  getLatestTicketsStats,
  getLatestRevenueStats,
  getStatsByMonth,
  getLatestTenBooking,
} from "../../services/bookingStatsService";

const lib = {
  map(value, inMin, inMax, outMin, outMax) {
    return ((value - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin;
  },
  range(start, end, tick) {
    const s = Math.round(start / tick) * tick;
    return Array.from(
      {
        length: Math.floor((end - start) / tick),
      },
      (v, k) => {
        return k * tick + s;
      }
    );
  },
};

// const options = {
//   xMin: -53,
//   xMax: 198,
//   yMin: -32,
//   yMax: 128,
//   line: {
//     smoothing: 0.15,
//     flattening: 0.5,
//   },
// };

export default {
  data() {
    return {
      staffStats: [],
      routeStats: [],
      statsToday: {},
      monthSelected: {},

      monthlyCumulativeStatistics: {},
      latestBookings: [],
      data: [],

      data2: [],
    };
  },
  created() {
    getStatsByMonth({
      startDate: "2022-04-01",
      endDate: "2022-04-30",
    }).then((res) => {
      this.monthlyCumulativeStatistics = res.data;
      console.log(res.data);
    });

    console.log("GENERRATIN SVG PATH");
    // this.svgPath()
    getLatestTenBooking().then((res) => {
      console.log(res);
      this.latestBookings = res.data;
    });
    getLatestTicketsStats().then((res) => {
      console.log(res);
      this.data = res.data;
    });
    getLatestRevenueStats().then((res) => {
      this.data2 = res.data;
      console.log(res);
      console.log("REVENUE STATS");
      console.log(res.data);
    });
    // getStaffStatsToday().then((res) => {
    //   console.log("STAFF STATS", res.data);
    //   this.staffStats = res.data;
    // });
    // getRouteStatsToday().then((res) => {
    //   this.routeStats = res.data;
    //   console.log("Route STats", this.routeStats);
    // });
    // getStatsByModalityToday().then((res) => {
    //   let ticketsSold = 0;
    //   let amount = 0;
    //   res.data.forEach((data) => {
    //     console.log(data);
    //     ticketsSold += Number(data.ticketsSold);
    //     amount += Number(data.amount);
    //     this.statsToday[data.modality] = data;
    //   });
    //   console.log(ticketsSold, amount);
    //   this.statsToday["TOTAL"] = { ticketsSold: ticketsSold, amount: amount };
    //   console.log("STATS TODAY", this.statsToday);
    // });
  },
  computed: {
    today() {
      let d = new Date();
      return d.toDateString();
    },

    computeDonutPercentage() {
      console.log(this.monthlyCumulativeStatistics);
      let online = Math.floor(
        (this.monthlyCumulativeStatistics.onlineTickets /
          this.monthlyCumulativeStatistics.ticketsSold) *
          100
      );
      console.log(`${online} ${100 - online}`);
      return `${online} ${100 - online}`;
    },
    viewBoxCompute() {
      return `0 0 ${this.svg.w} ${this.svg.h}`;
    },
  },
  methods: {
    thousandSeperator(number) {
      return number.toLocaleString("en-US", { maximumFractionDigits: 0 });
    },

    parseDateAsYearMonth(dateString) {
      let date = new Date(dateString);
      return `${date.toLocaleString("default", {
        month: "long",
      })} ${date.getFullYear()} `;
    },
    underConstructionMsg() {
      this.$toast.show("Under Construction");
    },

    resize() {
      console.log("CHARS CONTAINTER");
      console.log(this.$refs.chartContainer.offsetWidth);
      this.svg.w = this.$refs.chartContainer.offsetWidth;
      this.svg.h = this.$refs.chartContainer.offsetHeight;
    },

    //svg methods
    svgPath() {
      let points = [
        [0, 90],
        [10, 89],
        [20, 66],
        [30, 57],
        [40, 40],
        [50, 10],
        [60, 30],
      ];

      let ok = points.reduce(
        (acc, e, i, a) =>
          i === 0
            ? `M ${a[a.length - 1][0]},${this.svg.h}
              L ${e[0]},${this.svg.h} L ${e[0]},${e[1]}`
            : `${acc} ${this.bezierCommand(e, i, a)}`,
        ""
      );
      return `${ok}`;
    },

    line(pointA, pointB) {
      const lengthX = pointB[0] - pointA[0];
      const lengthY = pointB[1] - pointA[1];
      return {
        length: Math.sqrt(Math.pow(lengthX, 2) + Math.pow(lengthY, 2)),
        angle: Math.atan2(lengthY, lengthX),
      };
    },
    controlPoint(current, previous, next, reverse) {
      const p = previous || current;
      const n = next || current;
      const o = this.line(p, n);
      // work in progressâ€¦
      const flat = lib.map(Math.cos(o.angle) * 0.5, 0, 1, 1, 0);
      const angle = o.angle * flat + (reverse ? Math.PI : 0);
      const length = o.length * 0.15;
      const x = current[0] + Math.cos(angle) * length;
      const y = current[1] + Math.sin(angle) * length;
      return [x, y];
    },
    bezierCommand(point, i, a) {
      const cps = this.controlPoint(a[i - 1], a[i - 2], point);
      const cpe = this.controlPoint(point, a[i - 1], a[i + 1], true);
      const close = i === a.length - 1 ? " z" : "";
      return `C ${cps[0]},${cps[1]} ${cpe[0]},${cpe[1]} ${point[0]},${point[1]}${close}`;
    },

    saveImage() {
      const scale = 3;
      const node = document.getElementById("report");
      const style = {
        transform: "scale(" + scale + ")",
        transformOrigin: "top left",
        width: node.offsetWidth + "px",
        height: node.offsetHeight + "px",
      };

      const param = {
        height: node.offsetHeight * scale,
        width: node.offsetWidth * scale,
        quality: 1,
        style,
      };

      var filename = this.today.split(" ").join("");

      domtoimage.toPng(node, param).then(function (dataUrl) {
        var link = document.createElement("a");
        link.download = `report_${filename}.png`;
        link.href = dataUrl;
        link.click();
      });
    },
  },
};
</script>
